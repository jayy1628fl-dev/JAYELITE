<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCT Admin | PRO</title>
    <style>
        :root { --accent: #FFD700; --bg: #020617; }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: #0a0f1d; padding: 20px; border: 1px solid #222; text-align: center; border-radius: 8px; }
        .stat-card h1 { color: var(--accent); margin: 5px 0; }
        .box { background: #0a0f1d; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #222; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: white; }
        button { width: 100%; padding: 15px; background: var(--accent); border: none; font-weight: bold; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #222; font-size: 0.8rem; }
        #login-screen { display: flex; align-items: center; justify-content: center; height: 80vh; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div style="background:#0a0f1d; padding:40px; border:1px solid var(--accent); text-align:center;">
            <h2>JCT COMMAND</h2>
            <input type="password" id="passInput" placeholder="Access Code">
            <button onclick="checkPass()">Login</button>
        </div>
    </div>

    <div id="admin-content" style="display:none;">
        <h1>COMMAND CENTER</h1>
        
        <div class="grid-3">
            <div class="stat-card"><h3>Visits</h3><h1 id="stat-visits">0</h1></div>
            <div class="stat-card"><h3>Clicks</h3><h1 id="stat-clicks">0</h1></div>
            <div class="stat-card"><h3>Last Login</h3><p id="stat-time" style="font-size:0.7rem">Never</p></div>
        </div>

        <div class="box">
            <h3>Announcement Bar</h3>
            <input type="text" id="announceText" placeholder="Sale message...">
            <button onclick="updateAnnounce()">Update Live Banner</button>
        </div>

        <div class="box">
            <h3>Live Orders (from Buttons)</h3>
            <table id="order-table">
                <thead><tr><th>Service</th><th>Time</th><th>Status</th></tr></thead>
                <tbody id="order-list"></tbody>
            </table>
        </div>

        <div class="box">
            <h3>Add Service</h3>
            <input type="text" id="sName" placeholder="Name">
            <input type="text" id="sPrice" placeholder="Price">
            <button onclick="saveService()">Publish</button>
        </div>

        <button onclick="location.reload()" style="background:#333; color:white; margin-top:20px;">Logout Now</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC-3znjf5oxH2irY8zxt0c5JrjWVn7Rkf0",
            databaseURL: "https://jayct-b6e54-default-rtdb.firebaseio.com/",
            projectId: "jayct-b6e54",
            appId: "1:570915018020:web:bcc362b9cea1359ba94fb1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentData = {};

        // LOGIN & AUTO LOGOUT
        window.checkPass = function() {
            if(document.getElementById('passInput').value === "2026") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                set(ref(db, 'stats/lastLogin'), new Date().toLocaleString());
                setTimeout(() => { alert("Session Expired"); location.reload(); }, 600000); // 10 Min
            } else { alert("Denied"); }
        };

        // LOAD EVERYTHING
        onValue(ref(db), (snap) => {
            const all = snap.val() || {};
            currentData = all.siteData || {services:[], portfolio:[]};
            
            // Render Stats
            document.getElementById('stat-visits').innerText = all.stats?.visits || 0;
            document.getElementById('stat-clicks').innerText = all.stats?.clicks || 0;
            document.getElementById('stat-time').innerText = all.stats?.lastLogin || "None";

            // Render Orders
            const orders = all.orders || {};
            document.getElementById('order-list').innerHTML = Object.keys(orders).reverse().map(id => `
                <tr>
                    <td>${orders[id].service}</td>
                    <td>${orders[id].time}</td>
                    <td>
                        <select onchange="updateStatus('${id}', this.value)">
                            <option ${orders[id].status==='Pending'?'selected':''}>Pending</option>
                            <option ${orders[id].status==='In Progress'?'selected':''}>In Progress</option>
                            <option ${orders[id].status==='Done'?'selected':''}>Done</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        });

        window.updateAnnounce = () => {
            const txt = document.getElementById('announceText').value;
            update(ref(db, 'siteData'), { announcement: txt });
            alert("Banner Updated!");
        };

        window.updateStatus = (id, val) => {
            update(ref(db, 'orders/' + id), { status: val });
        };

        window.saveService = () => {
            const name = document.getElementById('sName').value;
            const price = document.getElementById('sPrice').value;
            if(!currentData.services) currentData.services = [];
            currentData.services.push({name, price});
            set(ref(db, 'siteData'), currentData);
        };
    </script>
</body>
</html>
