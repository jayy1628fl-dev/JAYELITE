<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCT HQ // Control</title>
    <style>
        :root { --accent: #FFD700; --bg: #050505; --panel: #111; }
        body { background: var(--bg); color: #fff; font-family: monospace; padding: 20px; margin: 0; }
        #hq { max-width: 1200px; margin: 0 auto; display:none; }
        .box { border: 1px solid #222; padding: 25px; background: #000; margin-bottom: 25px; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        input, select, textarea { width: 100%; background: #000; border: 1px solid #333; padding: 12px; color: #fff; margin: 8px 0; font-family: monospace; box-sizing: border-box; }
        textarea { height: 80px; resize: none; }
        button { width: 100%; background: #fff; color: #000; border: none; padding: 12px; font-weight: 900; cursor: pointer; text-transform: uppercase; margin-top: 5px; }
        button:hover { background: var(--accent); }
        .item-list { margin-top: 20px; border-top: 1px solid #222; padding-top: 15px; }
        .entry { background: #0a0a0a; padding: 15px; border: 1px solid #222; margin-bottom: 15px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .img-wrap { position: relative; border: 1px solid #222; background: #000; padding: 5px; }
        .img-wrap img { width: 100%; height: 100px; object-fit: cover; }
        .section-title { font-size: 10px; letter-spacing: 3px; color: var(--accent); text-transform: uppercase; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div id="login-wrap" style="height:90vh; display:flex; align-items:center; justify-content:center;">
        <div class="box" style="width:300px; text-align:center;">
            <p class="section-title">Security Key</p>
            <input type="password" id="pass" placeholder="ACCESS CODE">
            <button onclick="unlock()">ACCESS HQ</button>
        </div>
    </div>

    <div id="hq">
        <h2 style="letter-spacing:5px; margin-bottom:30px;">JCT // HQ COMMAND</h2>

        <div class="grid-2">
            <div class="box">
                <p class="section-title">Service Matrix</p>
                <input id="sn" placeholder="Service Title">
                <input id="sp" placeholder="Price (₦)">
                <textarea id="sd" placeholder="Client deliverables (e.g. PNG, PDF, 3 Mockups)"></textarea>
                <button onclick="addService()">Save Service</button>
                <div id="service-list" class="item-list"></div>
            </div>

            <div class="box">
                <p class="section-title">Gallery Assets</p>
                <select id="pCat"><option>Logos</option><option>Flyers</option><option>Branding</option></select>
                <textarea id="pd" placeholder="Work Title / Client Name"></textarea>
                <input type="file" accept="image/*" onchange="uploadImage(event)">
                <div id="gallery-list" class="gallery-grid item-list"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const config = {
            apiKey: "AIzaSyC-3znjf5oxH2irY8zxt0c5JrjWVn7Rkf0",
            databaseURL: "https://jayct-b6e54-default-rtdb.firebaseio.com/",
            projectId: "jayct-b6e54",
            appId: "1:570915018020:web:bcc362b9cea1359ba94fb1"
        };
        const app = initializeApp(config);
        const db = getDatabase(app);
        let siteData = { services: [], portfolio: [] };

        window.unlock = () => { if(document.getElementById('pass').value==="2026"){ document.getElementById('login-wrap').style.display='none'; document.getElementById('hq').style.display='block'; } };

        onValue(ref(db, 'siteData'), snap => {
            siteData = snap.val() || { services: [], portfolio: [] };
            renderUI();
        });

        window.addService = () => {
            const name = document.getElementById('sn').value, price = document.getElementById('sp').value, desc = document.getElementById('sd').value;
            if(!siteData.services) siteData.services = [];
            const idx = siteData.services.findIndex(s => s.name === name);
            idx > -1 ? siteData.services[idx] = {name, price, desc} : siteData.services.push({name, price, desc});
            save();
        };

        window.delService = (i) => { if(confirm('Erase?')){ siteData.services.splice(i,1); save(); } };
        window.editService = (i) => {
            const s = siteData.services[i];
            document.getElementById('sn').value = s.name; document.getElementById('sp').value = s.price; document.getElementById('sd').value = s.desc || "";
        };

        window.uploadImage = (e) => {
            const file = e.target.files[0], cat = document.getElementById('pCat').value, desc = document.getElementById('pd').value;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas'), maxW = 600;
                    const scale = maxW / img.width;
                    canvas.width = maxW; canvas.height = img.height * scale;
                    canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
                    if(!siteData.portfolio) siteData.portfolio = [];
                    siteData.portfolio.push({ url: canvas.toDataURL('image/jpeg', 0.6), category: cat, description: desc });
                    save(); document.getElementById('pd').value = "";
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        };

        window.delImg = (i) => { if(confirm('Erase?')){ siteData.portfolio.splice(i,1); save(); } };

        function renderUI() {
            document.getElementById('service-list').innerHTML = (siteData.services || []).map((s,i) => `
                <div class="entry">
                    <b>${s.name}</b>: ₦${s.price}<br><small style="color:#666">${s.desc || ''}</small>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button onclick="editService(${i})" style="font-size:9px; padding:4px;">Edit</button>
                        <button onclick="delService(${i})" style="font-size:9px; padding:4px; background:#300; color:red;">X</button>
                    </div>
                </div>`).join('');

            document.getElementById('gallery-list').innerHTML = (siteData.portfolio || []).map((img,i) => `
                <div class="img-wrap">
                    <img src="${img.url}">
                    <div onclick="delImg(${i})" style="position:absolute; top:2px; right:2px; background:red; color:white; padding:1px 5px; cursor:pointer;">X</div>
                </div>`).join('');
        }

        function save() { set(ref(db, 'siteData'), siteData).then(() => alert("SYNC COMPLETE")); }
    </script>
</body>
</html>
