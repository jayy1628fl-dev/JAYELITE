<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCT COMMAND | Admin</title>
    <style>
        body { background: #020617; color: white; font-family: 'Space Grotesk', sans-serif; padding: 40px 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .box { background: #0a0f1d; padding: 30px; border-radius: 12px; margin-bottom: 25px; border: 1px solid rgba(255,215,0,0.1); }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--accent); color: #000; padding: 20px; border-radius: 8px; text-align: center; }
        input { width: 100%; padding: 15px; margin: 10px 0; background: #000; border: 1px solid #333; color: white; border-radius: 4px; }
        button { width: 100%; padding: 15px; background: #FFD700; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; transition: 0.3s; }
        button:hover { filter: brightness(1.2); }
        .list-item { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #222; align-items: center; }
        .port-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; }
        #loginGate { position: fixed; inset: 0; background: #020617; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="loginGate">
        <div class="box" style="width: 300px; text-align: center;">
            <h3>ADMIN ACCESS</h3>
            <input type="password" id="pass" placeholder="Enter Command Key">
            <button onclick="checkPass()">ENTER</button>
        </div>
    </div>

    <div class="container">
        <h1 style="letter-spacing: 4px; margin-bottom: 30px; color: #FFD700;">JCT // COMMAND</h1>

        <div class="stats">
            <div class="stat-card">
                <small>SERVICES</small>
                <h2 id="count-s">0</h2>
            </div>
            <div class="stat-card">
                <small>PORTFOLIO</small>
                <h2 id="count-p">0</h2>
            </div>
        </div>
        
        <div class="box">
            <h3>Add New Service</h3>
            <input type="text" id="sName" placeholder="Service Name (e.g. Motion Branding)">
            <input type="number" id="sPrice" placeholder="Price (Numbers only)">
            <button onclick="saveService()">PUBLISH TO SITE</button>
        </div>

        <div class="box">
            <h3>Upload to Archive</h3>
            <input type="file" id="pImg" accept="image/*" onchange="uploadWork(event)">
            <p style="font-size: 0.7rem; margin-top: 10px; opacity: 0.5;">Maximum image size: 2MB</p>
        </div>

        <div class="box">
            <h3>Live Content Management</h3>
            <div id="services-list"></div>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #333;">
            <div id="portfolio-list" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC-3znjf5oxH2irY8zxt0c5JrjWVn7Rkf0",
            authDomain: "jayct-b6e54.firebaseapp.com",
            databaseURL: "https://jayct-b6e54-default-rtdb.firebaseio.com/",
            projectId: "jayct-b6e54",
            appId: "1:570915018020:web:bcc362b9cea1359ba94fb1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentData = { services: [], portfolio: [] };

        window.checkPass = () => {
            if(document.getElementById('pass').value === 'JCT2026') {
                document.getElementById('loginGate').style.display = 'none';
            } else { alert('Wrong key.'); }
        };

        onValue(ref(db, 'siteData'), (snap) => {
            if(snap.val()) {
                currentData = snap.val();
                renderAdmin();
            }
        });

        window.saveService = function() {
            const name = document.getElementById('sName').value;
            const price = document.getElementById('sPrice').value;
            if(name && price) {
                if(!currentData.services) currentData.services = [];
                currentData.services.push({ name, price: parseInt(price).toLocaleString() });
                set(ref(db, 'siteData'), currentData).then(() => {
                    alert("Service Published!");
                    document.getElementById('sName').value = '';
                    document.getElementById('sPrice').value = '';
                });
            }
        };

        window.uploadWork = function(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                if(!currentData.portfolio) currentData.portfolio = [];
                currentData.portfolio.push(event.target.result);
                set(ref(db, 'siteData'), currentData).then(() => alert("Work Added to Archive!"));
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        function renderAdmin() {
            document.getElementById('count-s').innerText = (currentData.services || []).length;
            document.getElementById('count-p').innerText = (currentData.portfolio || []).length;

            const sList = document.getElementById('services-list');
            sList.innerHTML = (currentData.services || []).map((s, i) => `
                <div class="list-item">
                    <span>${s.name} (â‚¦${s.price})</span>
                    <button onclick="deleteItem('services', ${i})" style="width:auto; padding:5px 10px; background:red; color:white;">Remove</button>
                </div>
            `).join('');

            const pList = document.getElementById('portfolio-list');
            pList.innerHTML = (currentData.portfolio || []).map((img, i) => `
                <div style="position:relative">
                    <img src="${img}" class="port-thumb">
                    <div onclick="deleteItem('portfolio', ${i})" style="position:absolute; top:0; right:0; background:red; cursor:pointer; padding:2px 5px; font-size:10px;">X</div>
                </div>
            `).join('');
        }

        window.deleteItem = function(type, i) {
            if(confirm('Delete this item?')) {
                currentData[type].splice(i, 1);
                set(ref(db, 'siteData'), currentData);
            }
        };
    </script>
</body>
</html>
